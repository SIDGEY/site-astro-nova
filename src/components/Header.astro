---
import { getEntry } from 'astro:content';

const settings = await getEntry('settings', 'general');
if (!settings) return Astro.redirect('/404');
const { navigation } = settings.data;
---
<nav class="sticky top-0 left-0 right-0 px-6 transition-all duration-300 border-b z-[999] bg-slate-800 border-slate-600/50 py-4">
  <div class="container-custom flex justify-between items-center h-20">
    <a href="/" class="text-2xl font-bold text-text tracking-tighter" aria-label="Atecna - Accueil">
      <img src="https://play-astronova.com/logo-horizontal.svg" alt="Astro Nova" class="h-12 w-auto" />
    </a>
    
    <div class="hidden md:flex space-x-10 items-center">
      {navigation.map(item => (
        <a 
          href={item.link} 
          class="text-slate-300 hover:text-blue-300 transition-colors"
          aria-current={(Astro.url.pathname || "") === item.link ? 'page' : undefined}
        >
          {item.label}
        </a>
      ))}
      <button onclick="" class="py-2 px-6 whitespace-nowrap bg-blue-500 hover:bg-blue-600 rounded-md font-medium h-10 mr-2">S'inscrire Ã  la bÃªta</button>
      <a class="py-2 px-6 whitespace-nowrap border border-slate-600 backdrop-blur-xl text-slate-200 rounded-md font-medium h-10" href="https://astro-nova-recette.web.app/game">Jouer</a>
    </div>

    <button
      id="mobile-menu-toggle"
      class="md:hidden top-0 right-0 flex items-center justify-center w-12 h-12 rounded-full bg-slate-950 hover:bg-slate-900/90 transition-colors z-[1000] overflow-hidden"
      aria-label="Menu principal"
      aria-controls="mobile-menu"
      aria-expanded="false"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg>
    </button>
  </div>

  <div id="mobile-menu" class="md:hidden hidden border-t border-border bg-surface/95 backdrop-blur-md">
    <div class="container-custom flex flex-col gap-4 py-4">
      {navigation.map(item => (
        <a
          href={item.link}
          class="text-slate-200 hover:text-blue-400 transition-colors py-4 text-2xl font-medium w-full"
          aria-current={(Astro.url.pathname || "") === item.link ? 'page' : undefined}
        >
          {item.label}
        </a>
      ))}
      <a href="/parler-ia" class="btn btn-primary btn-sm w-fit">Parler Ã  un expert</a>
      <button
        id="dark-mode-toggle-mobile"
        class="w-fit p-2.5 rounded-xl hover:bg-surface-2 transition-colors focus-visible:ring-4 focus-visible:ring-ring group"
        aria-label="Changer le thÃ¨me"
      >
        <span class="dark:hidden group-hover:scale-110 transition-transform inline-block" aria-hidden="true">ğŸŒ™</span>
        <span class="hidden dark:inline group-hover:scale-110 transition-transform inline-block" aria-hidden="true">â˜€ï¸</span>
        <span class="sr-only">Passer en mode {Astro.cookies.get('theme')?.value === 'dark' ? 'clair' : 'sombre'}</span>
      </button>
    </div>
  </div>
</nav>

<script is:inline>
  const toggle = document.getElementById('dark-mode-toggle');
  const toggleMobile = document.getElementById('dark-mode-toggle-mobile');
  const applyTheme = (isDark) => {
    document.documentElement.classList.toggle('dark', isDark);
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  };

  if (toggle) {
    toggle.addEventListener('click', () => {
      applyTheme(!document.documentElement.classList.contains('dark'));
    });
  }

  if (toggleMobile) {
    toggleMobile.addEventListener('click', () => {
      applyTheme(!document.documentElement.classList.contains('dark'));
    });
  }

  const menuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileLinks = mobileMenu?.querySelectorAll('a');
  const setMenuOpen = (isOpen) => {
    if (!menuToggle || !mobileMenu) return;
    menuToggle.setAttribute('aria-expanded', String(isOpen));
    mobileMenu.classList.toggle('hidden', !isOpen);
  };

  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener('click', () => {
      const isOpen = menuToggle.getAttribute('aria-expanded') === 'true';
      setMenuOpen(!isOpen);
    });
  }

  if (mobileLinks && menuToggle) {
    mobileLinks.forEach((link) => {
      link.addEventListener('click', () => setMenuOpen(false));
    });
  }

  // Initial theme setup
  const theme = localStorage.getItem('theme');
  if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }
</script>
